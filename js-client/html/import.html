<div class="import">
    <div>
        <h1>Import</h1>
        <div>
            <textarea v-on:change="parsedItem = parseData(importText)" v-model="importText" placeholder="Paste exported data here"></textarea>
        </div>
    </div>

    <div>
        <h1>Parsed data</h1>
            <div class="scroll">
            <table class="border-table" v-if="parsedItem">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>NAME</th>
                        <th>SET</th>
                        <th>CONDITION</th>
                        <th>LANG</th>
                        <th>FOIL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="item in parsedItem"  :key="item.uuid">
                        <td>{{ item.id }}</td>
                        <td>{{ item.name }}</td>
                        <td>{{ item.setName }}</td>
                        <td>{{ item.condition }}</td>
                        <td>{{ item.lang }}</td>
                        <td>{{ item.foil ? "X" : "" }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<button v-on:click="importNew(parsedItem); importText = ''; parsedItem = [];">Save to Unimported</button>
<button v-on:click="lookupMissingItems()">Match w Cardmarket</button>
<button v-on:click="importToCardmarket()">Import to Cardmarket</button>

<button v-on:click="clearIds()">Clear ID</button>
<button v-on:click="clearUnimported()">Clear Unimported</button>

<h1>Unimported stock</h1>
<table class="border-table" v-if="savedItems">
    <tr>
        <th>ID</th>
        <th>NAME</th>
        <th>SET</th>
        <th>CONDITION</th>
        <th>LANG</th>
        <th>FOIL</th>
        <th>STATUS</th>
        <th>WARNINGS</th>
        <th>ERRORS</th>
        <th>LOG</th>
    </tr>

    <tr v-for="item in savedItems"  :key="item.uuid">
        <td>{{ item.id }}</td>
        <td>
            <span v-if="(item?.oldName?.length || 0) > 0" v-bind:class="{ strike: (item?.oldName?.length || 0) > 0 }">{{item.oldName}}<br /></span>
            <input v-model="item.name">
        </td>
        <td>
            <span v-if="(item?.oldSetName?.length || 0) > 0" v-bind:class="{ strike: (item?.oldSetName?.length || 0) > 0 }">{{item.oldSetName}}</span>
            <select v-if="item.altSet" v-model="item.setName">
                <option>{{item.setName}}</option>
                <option v-if="item.oldSetName">{{item.oldSetName}}</option>
                <option v-for="opt in item.altSet">{{opt}}</option>
            </select>
        </td>
        <td>
            <select v-model="item.condition">
                <option value="MT">Mint</option>
                <option value="NM">Near Mint</option>
                <option value="EX">Excellent</option>
                <option value="GD">Good</option>
                <option value="LP">Light Played</option>
                <option value="PL">Played</option>
                <option value="PO">Poor</option>
            </select>
        </td>
        <td>{{ item.lang }}</td>
        <td>
            <select v-if="item.altSet" v-model="item.foil">
                <option v-bind:value="true">Yes</option>
                <option v-bind:value="false">No</option>
            </select>
        </td>
        <td>
            <div v-if='item.status == "lookup"' class='spinner xsmall'></div>
            <span v-if='item.status !== "lookup"'>
                <button v-on:click="resetStatus(item)">{{ item.status }}</button>
            </span>
        </td>
        <td>
            {{ item.warnings.map(x => x.key + ': ' + x.value).join(', ') }}
        </td>
        <td>
            {{ item.errors.map(x => x.key + ': ' + x.value).join(', ') }}
        </td>
        <td><button v-if="item.id" v-on:click="lookupProduct(item.id)">Lookup</button></td>
    </tr>
</table>
